---
title: "配置指南"
description: "按需调优你的 MemMachine API"
icon: "gear"
---
## 配置 MemMachine

MemMachine 的主要配置文件是 `cfg.yml`。

你可以通过两类配置自定义应用行为：**全局配置**与**本地配置**。
- **全局配置**：作为所有应用的***默认***设置，除非被覆盖，否则始终生效。建议保存于项目根目录。
- **本地配置**：用于某个会话或任务的特定调节，适合多智能体场景（给不同智能体提供不同配置）。相应文件应放在每个智能体的根目录。

当同时存在本地配置时，它会优先覆盖全局配置，帮助你在不影响全局的情况下临时调整。唯一的例外是插件配置，始终使用全局设置。

在 `cfg.yml` 中可以使用 YAML 语法设置上述配置。下文列出了各类可用项及示例。

## 根据需求自定义 MemMachine

以下列出常用配置项、设置示例、建议放置位置以及更多说明链接：

<AccordionGroup>
  <Accordion title="日志 (Logging)">

用于控制日志存储路径与日志级别。
| 参数        | 必填？ | 默认值             | 说明                                      |
| ----------- | ------ | ------------------ | ----------------------------------------- |
| `path`      | 否     | `/tmp/memory_log`  | 日志文件的保存路径与文件名。              |
| `level`     | 否     | `info`             | 可选 `info`、`debug`、`error` 三种级别。   |

配置示例：
```YAML
logging:
  path: /tmp/memory_log
  level: info #| debug | error
```
</Accordion>
<Accordion title="长期记忆 (Long-Term Memory)">

用于配置长期记忆相关参数。
| 参数                        | 必填？ | 默认值     | 说明                                                         |
| --------------------------- | ------ | ---------- | ------------------------------------------------------------ |
| `derivative_deriver`        | 否     | `sentence` | 指定从记忆内容提炼新信息的方法，可选 `identity` 或 `sentence`。 |
| `metadata_derivative_format`| 否     | N/A        | 用于格式化派生元数据的模板字符串，可引用 `user_metadata[source_timestamp]`、`isolation_properties[producer_id]` 等。 |
| `embedder`                  | 否     | N/A        | 长期记忆使用的向量嵌入模型 ID。                              |
| `reranker`                  | 否     | N/A        | 重排器 ID，用于提升检索结果相关性。                          |
| `vector_graph_store`        | 否     | N/A        | 长期记忆与向量图存储使用的存储供应商 ID。                    |

配置示例：
```YAML
long_term_memory:
  derivative_deriver: sentence
  metadata_prefix: "[$timestamp] $producer_id: "
  embedder: my_embedder_id
  reranker: my_reranker_id
  vector_graph_store: my_storage_id
```
</Accordion>
<Accordion title="画像记忆 (Profile Memory)">

用于配置画像记忆相关参数。
| 参数                | 必填？ | 默认值             | 说明                                                         |
| ------------------- | ------ | ------------------ | ------------------------------------------------------------ |
| `llm_model`         | 是     | `testmodel`        | 画像信息抽取所用的语言模型。                                 |
| `embedding_model`   | 是     | N/A                | 画像记忆使用的向量嵌入模型。                                 |
| `database`          | 是     | `profile_storage`  | 画像数据库连接配置，使用默认值可在该子节中定义其余字段。     |
| `prompt`            | 是     | `profile_prompt`   | 画像记忆所用的系统提示词。                                    |


```YAML
profile_memory:
  llm_model: testmodel
  embedding_model: my_embedder_id
  database: profile_storage
  prompt: profile_prompt
```
</Accordion>
<Accordion title="SessionDB">

SessionDB 只包含一个参数，即数据库连接 URI。
| 参数   | 必填？ | 默认值         | 说明                                                         |
| ------ | ------ | -------------- | ------------------------------------------------------------ |
| `uri`  | 是     | `sqlitetest.db`| 数据库连接 URI。如未指定，MemMachine 会自动创建 `SQLitetest.db`。 |

配置示例：
```YAML
SessionDB:
  uri: sqlitetest.db
```
</Accordion>
<Accordion title="模型 (Model)">

用于指定 MemMachine 所使用的 LLM。

<Note>`another_model_id` 可以是你自定义的任意唯一标识，但在配置中引用该模型时需使用相同标识。示例展示了 AWS Bedrock 的必要配置。</Note>
| 参数                | 必填？ | 默认值              | 说明                                                         |
| ------------------- | ------ | ------------------- | ------------------------------------------------------------ |
| `testmodel`         | 是     | `testmodel`         | 使用 OpenAI 时的默认配置 ID。                                 |
| `model_vendor`      | 是     | `openai`            | 模型提供商（如 `openai`、`amazon-bedrock`）。                 |
| `model_name`        | 是     | `"gpt-4o-mini"`    | 具体模型名称。                                                |
| `api_key`           | 是     | N/A                 | 使用 OpenAI 或默认配置时需提供 API Key。                      |
| `another_model_id`  | 否     | `another_model_id`  | 其它模型配置的唯一标识。                                      |
| `region`            | 否     | N/A                 | Bedrock 模型的 AWS 区域（如 `us-west-2`）。                   |
| `aws_access_key_id` | 否     | N/A                 | Bedrock 认证所需的访问密钥 ID。                               |
| `aws_secret_access_key`| 否  | N/A                 | Bedrock 认证所需的密钥。                                      |

An example of these parameters in a config file would look like the following:
```YAML
Model:
  testmodel:
    model_vendor: openai
    model_name: "gpt-4o-mini"
    api_key: <YOUR_API_KEY>
  another_model_id:
    model_vendor: "amazon-bedrock"
    region: "us-west-2"
    aws_access_key_id: <AWS_ACCESS_KEY_ID>
    aws_secret_access_key: <AWS_SECRET_ACCESS_KEY>
    model_id: "openai.gpt-oss-20b-1:0"
```
</Accordion>
<Accordion title="存储 (Storage)">

用于配置记忆存储所使用的数据库。

需分别为 `my_storage_id`（长期记忆）和 `profile_storage`（画像记忆）设置参数，以使用不同的数据库。
<Note>目前 Episodic Memory 仅支持 Neo4j 图数据库，Profile Memory 使用 Postgres。</Note>

| 参数                     | 必填？ | 默认值     | 说明                                                         |
| ------------------------ | ------ | ---------- | ------------------------------------------------------------ |
| `<ID>.vendor_name`       | 是     | `neo4j`    | 长期记忆所用数据库供应商名称。                               |
| `<ID>.host`              | 是     | `localhost`| 数据库服务器主机或 IP。                                     |
| `<ID>.port`              | 是     | `7687`     | 数据库连接端口。                                             |
| `<ID>.user`              | 是     | N/A        | 数据库认证用户。                                             |
| `<ID>.password`          | 是     | N/A        | 数据库认证密码。                                             |
| `profile_storage`        | 是     | N/A        | 画像数据库配置（Postgres）。                                 |
| `<ID>.vendor_name`       | 是     | `postgres` | 画像数据库供应商名称。                                       |
| `<ID>.host`              | 是     | `localhost`| 画像数据库主机或 IP。                                        |
| `<ID>.port`              | 是     | `5432`     | 画像数据库端口。                                             |
| `<ID>.user`              | 是     | `postgres` | 画像数据库认证用户。                                         |
| `<ID>.db_name`           | 是     | `postgres` | 画像数据库名称。                                             |
| `<ID>.password`          | 是     | N/A        | 画像数据库认证密码。                                         |


```YAML
storage:
  my_storage_id:
    vendor_name: neo4j
    host: localhost
    port: 7687
    user: neo4j
    password: <YOUR_PASSWORD_HERE>

  profile_storage:
    vendor_name: postgres
    host: localhost
    port: 5432
    user: postgres
    db_name: postgres
    password: <YOUR_PASSWORD_HERE>
```
</Accordion>
<Accordion title="会话记忆 (Session Memory)">

| 参数                | 必填？ | 默认值 | 说明                                                      |
| ------------------- | ------ | ------ | --------------------------------------------------------- |
| `model_name`        | 否     | N/A    | 会话记忆使用的模型 ID。                                    |
| `message_capacity`  | 否     | 500    | 会话记忆可保存的最大消息数。                               |
| `max_message_length`| 否     | 16000  | 单条消息的最大长度。                                       |
| `max_token_num`     | 否     | 8000   | 会话记忆中可保存的最大 token 数。                          |

配置示例：
```YAML
sessionMemory:
  model_name: testmodel
  message_capacity: 500
  max_message_length: 16000
  max_token_num: 8000
```
</Accordion>

<Accordion title="嵌入模型 (Embedder)">

配置可选的向量嵌入模型。
<Note>`aws_embedder_id` 参数仅在使用 AWS Bedrock 嵌入模型时需要。默认的 `my_embedder_id` 已为 OpenAI 嵌入模型预设。</Note>

| 参数                  | 必填？ | 默认值                 | 说明                                                         |
| --------------------- | ------ | ---------------------- | ------------------------------------------------------------ |
| `my_embedder_id`      | 否     | N/A                    | 默认嵌入模型标签，适用于 OpenAI。                             |
| `<ID>.name`           | 否     | `openai`               | 嵌入模型供应商名称。                                        |
| `<ID>.model_name`     | 否     | `"text-embedding-3-small"` | 供应商提供的嵌入模型名称。                           |
| `<ID>.api_key`        | 否     | N/A                    | 使用 OpenAI 时的 API Key。                                   |
| `aws_embedder_id`     | 否     | N/A                    | 使用 AWS Bedrock 时的嵌入模型标签。                         |
| `<ID>.name`           | 否     | `amazon-bedrock`       | Bedrock 嵌入模型供应商名称。                                 |
| `<ID>.region`         | 否     | N/A                    | Bedrock 嵌入模型所在的 AWS 区域（如 `us-west-2`）。          |
| `<ID>.aws_access_key_id` | 否  | N/A                    | Bedrock 认证所需的访问密钥 ID。                             |
| `<ID>.aws_secret_access_key`|否| N/A                    | Bedrock 认证所需的密钥。                                     |
| `<ID>.model_id`       | 否     | N/A                    | Bedrock 嵌入模型 ID。                                        |
| `<ID>.similarity_metric`| 否   | `"cosine"`           | 向量相似度度量方式（如 `cosine`、`euclidean`）。             |

配置示例：
```YAML
embedder:
  my_embedder_id:
    name: openai
    config:
      model_name: "text-embedding-3-small"
      api_key: <YOUR_API_KEY>
  aws_embedder_id:
    name: 'amazon-bedrock'
    config:
      region: "us-west-2"
      aws_access_key_id: <AWS_ACCESS_KEY_ID>
      aws_secret_access_key: <AWS_SECRET_ACCESS_KEY>
      model_id: "amazon.titan-embed-text-v2:0"
      similarity_metric: "cosine"
```
</Accordion>
<Accordion title="重排器 (Reranker)">

设置重排器相关参数。
<Note>`aws_reranker_id` 仅在使用 AWS Bedrock 重排模型时需要。若使用 Bedrock，请在 `reranker_ids` 中列出并配置对应参数。</Note>

<Info>`ce_ranker_id` 仅适用于具备 GPU 的系统。</Info>

| 参数              | 必填？ | 默认值           | 说明                                                         |
| ----------------- | ------ | ---------------- | ------------------------------------------------------------ |
| `my_reranker_id`  | 是     | N/A              | 定义需要使用的重排器集合。                                   |
| `<ID>.type`       | 是     | N/A              | 重排器类型（如 `rrf-hybrid`、`identity`、`bm25`、`cross-encoder`、`amazon-bedrock`）。 |
| `<ID>.reranker_ids`| 是    | N/A              | 混合重排器所包含的重排器 ID 列表。                           |
| `id_ranker_id`    | 否     | N/A              | Identity 重排器配置。                                        |
| `bm_ranker_id`    | 否     | N/A              | BM25 重排器配置。                                            |
| `ce_ranker_id`    | 否     | `"cross-encoder"`| Cross-Encoder 重排器配置。                                   |
| `<ID>.model_name` | 否     | N/A              | Cross-Encoder 重排器所用模型名称。                           |
| `aws_reranker_id` | 否     | N/A              | 使用 AWS Bedrock 重排器时的标签。                            |
| `<ID>.region`     | 否     | N/A              | Bedrock 重排器的 AWS 区域。                                  |
| `<ID>.aws_access_key_id` | 否 | N/A           | Bedrock 认证所需访问密钥 ID。                                |
| `<ID>.aws_secret_access_key`| 否| N/A         | Bedrock 认证所需密钥。                                       |
| `<ID>.model_id`   | 否     | N/A              | Bedrock 重排模型 ID。                                        |

An example of these parameters in a config file would look like the following:
```YAML
reranker:
  my_reranker_id:
    type: "rrf-hybrid"
    reranker_ids:
      - id_ranker_id
      - bm_ranker_id
      - ce_ranker_id
  id_ranker_id:
    type: "identity"
  bm_ranker_id:
    type: "bm25"
  ce_ranker_id:
    type: "cross-encoder"
    model_name: "cross-encoder/qnli-electra-base"
  aws_reranker_id:
    type: "amazon-bedrock"
    region: "us-west-2"
    aws_access_key_id: <AWS_ACCESS_KEY_ID>
    aws_secret_access_key: <AWS_SECRET_ACCESS_KEY>
    model_id: "amazon.rerank-v1:0"
```
</Accordion>
</AccordionGroup>