---
title: "记忆类型"
description: "MemMachine 如何组织记忆"
icon: "memory"
---
## 记忆类型概览

MemMachine 作为覆盖在 Agentic LLM 之上的智能记忆层，会通过 Python API 接收输入，并判断这些信息应归属于画像、短期或长期记忆：  
- **画像记忆（Profile Memory）**：保存用户及其体验的特定信息。  
- **短期记忆（Short-term Memory）**：由情景记忆（episodic memory）及其摘要构成，原始情景记忆一条消息即一个 Episode。  
- **长期记忆（Long-term Memory）**：由短期记忆批量生成的 Episode 集合，经重排器排序并对高频结果去重。

## MemMachine 如何划分记忆类型？

MemMachine 先通过嵌入模型将用户/智能体语言拆解为计算机可理解的派生信息，再通过重排器与长期记忆中的内容进行比对，返回排序后的候选结果。

重排流程结束后，相应记忆会写入对应的数据库。  



### 画像记忆（Profile Memory）

画像记忆聚焦于用户及其体验的特定信息，数据存储在 PostgreSQL 中。

**存储流程**
1. 原始用户消息写入 `session_history`
2. LLM 分析对话，提取关键信息
3. 结构化知识连同向量嵌入写入 `memvergeprofile`
4. `citations` 表记录每条知识的来源对话

**检索流程**
1. **Query：** 用户提问或系统需要上下文
2. **语义搜索：** 通过向量嵌入匹配相关知识
3. **检索返回：** 输出匹配的画像条目及其来源对话
4. **上下文追溯：** 引用信息可回溯至原始对话


#### 数据库结构：画像记忆表

MemMachine 基于 **PostgreSQL** 并结合 `pgvector` 扩展实现高效的向量相似度搜索。可将其理解为一套可以快速找到相似信息的机制。系统将画像记忆组织在**三张核心表**中，分别用于存储用户画像、对话历史及两者之间的关联关系。


<Tabs>
    <Tab title ="Profile 表">
 **说明：** 这是存储用户画像及其特征的主表，配合**向量嵌入**实现强大的**语义搜索**。
 
 **用途：** 以键值对与向量嵌入形式保存用户画像，使系统可以通过语义检索快速定位相关特征。

示例结构：
```bash
Column   |           Type           | Collation | Nullable |             Default              
------------+--------------------------+-----------+----------+----------------------------------
 id         | integer                  |           | not null | nextval('prof_id_seq'::regclass)
 user_id    | text                     |           | not null | 
 tag        | text                     |           | not null | 'Miscellaneous'::text
 feature    | text                     |           | not null | 
 value      | text                     |           | not null | 
 create_at  | timestamp with time zone |           | not null | CURRENT_TIMESTAMP
 update_at  | timestamp with time zone |           | not null | CURRENT_TIMESTAMP
 embedding  | vector(1536)             |           | not null | 
 metadata   | jsonb                    |           | not null | '{}'::jsonb
 isolations | jsonb                    |           | not null | '{}'::jsonb
Indexes:
    "prof_pkey" PRIMARY KEY, btree (id)
Referenced by:
    TABLE "citations" CONSTRAINT "citations_profile_id_fkey" FOREIGN KEY (profile_id) REFERENCES prof(id) ON DELETE CASCADE
```

表中包含以下字段：

| 字段        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| id          | 每条知识的唯一标识。                                         |
| user_id     | 与智能体互动的用户唯一 ID，用于归档该用户的全部信息。        |
| tag         | 高层级分类（如 “Preferences”、“Skills”、“Background”）。   |
| feature     | 信息摘要（如 “likes_pizza”、“programming_language”）。      |
| value       | 对应的具体内容（如 “Margherita with extra cheese”、“Python, JavaScript, Go”）。 |
| create_at   | 记录创建时间。                                               |
| update_at   | 记录最近更新时间。                                           |
| embedding   | 1536 维向量，为每条记忆生成独特“指纹”，支持语义检索。       |
| metadata    | JSONB 字段，存储额外结构化信息。                             |
| isolations  | JSONB 字段，存储隔离参数，可根据条件限制访问。               |

<Note>`unique_utfv` 约束确保同一用户的相同 tag、feature、value 组合不会重复。</Note>
</Tab>
    <Tab title="History 表">

**说明：** 该表存储对话中的所有消息与交互，帮助系统保留**上下文**并随时回溯，提升对话连贯性。

**用途：** 维护对话与交互的**历史记录**，为丰富画像和提供上下文支撑。

示例结构：
```bash
   Column   |           Type           | Collation | Nullable |               Default               
------------+--------------------------+-----------+----------+-------------------------------------
 id         | integer                  |           | not null | nextval('history_id_seq'::regclass)
 user_id    | text                     |           | not null | 
 content    | text                     |           | not null | 
 create_at  | timestamp with time zone |           | not null | CURRENT_TIMESTAMP
 metadata   | jsonb                    |           | not null | '{}'::jsonb
 isolations | jsonb                    |           | not null | '{}'::jsonb
Indexes:
    "history_pkey" PRIMARY KEY, btree (id)
Referenced by:
    TABLE "citations" CONSTRAINT "citations_content_id_fkey" FOREIGN KEY (content_id) REFERENCES history(id) ON DELETE CASCADE
```
表字段说明：

| 字段        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| id          | 每条对话记录的唯一标识。                                     |
| user_id     | 对话关联的用户 ID。                                          |
| content     | 对话文本内容。                                               |
| create_at   | 记录创建时间。                                               |
| metadata    | JSONB 字段，存储额外结构信息。                               |
| isolations  | JSONB 字段，存储隔离参数，可基于特定条件限制访问。           |

</Tab>
    <Tab title="Citations 表">

**说明：** 作为用户画像与对话历史之间的连接表，将画像特征与支撑它的对话条目关联起来。

**用途：** 便于追踪某个画像特征的来源，验证其可靠性。

示例结构：
```bash
    Column   |  Type   | Collation | Nullable | Default 
------------+---------+-----------+----------+---------
 profile_id | integer |           | not null | 
 content_id | integer |           | not null | 
Indexes:
    "citations_pkey" PRIMARY KEY, btree (profile_id, content_id)
Foreign-key constraints:
    "citations_content_id_fkey" FOREIGN KEY (content_id) REFERENCES history(id) ON DELETE CASCADE
    "citations_profile_id_fkey" FOREIGN KEY (profile_id) REFERENCES prof(id) ON DELETE CASCADEgit st
```
表字段说明：
| 字段        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| profile_id  | 指向 `memvergeprofile` 中的画像条目。                         |
| content_id  | 指向 `session_history` 中的对话记录。                         |
    </Tab>
</Tabs>
